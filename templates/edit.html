<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edit product</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; max-width: 820px; }
    h1 { margin: 0 0 6px; }
    .muted { color:#666; margin: 0 0 18px; }
    form { display:grid; grid-template-columns: 2fr 1fr 1fr; gap:10px; align-items:end; }
    input, select, button { padding:10px; border:1px solid #ccc; border-radius:10px; }
    button { cursor:pointer; font-weight:600; }
    .row { display:flex; gap:10px; margin-top:14px; }
    a { text-decoration:none; }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; background:#f3f3f3; }
    .small { font-size: 12px; color:#666; }
  </style>
</head>
<body>
  <h1>✏️ Edit product</h1>
  <p class="muted">Update fields and save. Sale price is recalculated automatically.</p>

  <p class="small">
    Category margins:
    {% for c in categories %}
      <span class="pill">{{ c }} {{ (category_margins[c]*100)|round(0) }}%</span>
    {% endfor %}
  </p>

  <form method="post" action="{{ url_for('update', pid=p['id'], q=q, cat=cat) }}">
    <div>
      <label>Product</label><br>
      <input name="name" value="{{ p['name'] }}" required>
    </div>

    <div>
      <label>Category</label><br>
      <select name="category" required>
        {% for c in categories %}
          <option value="{{ c }}" {% if p["category"] == c %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label>Cost</label><br>
      <input name="cost" type="number" step="0.01" min="0" value="{{ p['cost'] }}" required>
    </div>

    <div>
      <label>Stock</label><br>
      <input name="stock" type="number" step="1" min="0" value="{{ p['stock'] }}" required>
    </div>

    <div>
      <label>Min stock</label><br>
      <input name="min_stock" type="number" step="1" min="0" value="{{ p['min_stock'] }}" required>
    </div>

    <div class="row" style="justify-content:flex-end;">
      <button type="submit">Save</button>
      <a href="{{ url_for('index', q=q, cat=cat) }}"><button type="button">Cancel</button></a>
    </div>
  </form>
</body>
</html>
